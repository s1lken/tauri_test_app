<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tauri Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 p-8">
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-2xl p-6">
      <h1 class="text-2xl font-bold mb-4">Tauri API Test</h1>
      <div id="status" class="mb-4 p-4 rounded-lg bg-gray-100"></div>
      <button id="test-btn" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
        Test Backend
      </button>
    </div>

    <script>
      const statusEl = document.getElementById('status');
      const testBtn = document.getElementById('test-btn');
      
      function updateStatus(message, type = 'info') {
        const colors = {
          info: 'bg-blue-100 text-blue-800',
          success: 'bg-green-100 text-green-800',
          error: 'bg-red-100 text-red-800'
        };
        statusEl.className = `mb-4 p-4 rounded-lg ${colors[type]}`;
        statusEl.innerHTML = message;
      }
      
      async function testTauriAPI() {
        updateStatus('Testing Tauri API...', 'info');
        
        // Check multiple possible API locations
        const checks = [
          () => window.__TAURI__?.core?.invoke,
          () => window.__TAURI__?.invoke,
          () => window.__TAURI_INVOKE__,
          () => globalThis.__TAURI__?.core?.invoke,
          () => globalThis.__TAURI__?.invoke
        ];
        
        let invoke = null;
        for (const check of checks) {
          try {
            invoke = check();
            if (invoke) {
              updateStatus(`✅ Found Tauri API via: ${check.toString()}`, 'success');
              break;
            }
          } catch (e) {
            console.log('Check failed:', e);
          }
        }
        
        if (!invoke) {
          updateStatus('❌ Tauri API not found. Available globals:<br>' + 
                      Object.keys(window).filter(k => k.includes('TAURI')).join(', '), 'error');
          return;
        }
        
        // Test the invoke function
        try {
          updateStatus('Calling button_clicked command...', 'info');
          const response = await invoke('button_clicked');
          updateStatus(`✅ Success! Response: "${response}"`, 'success');
        } catch (error) {
          updateStatus(`❌ Error calling backend: ${error}`, 'error');
        }
      }
      
      testBtn.addEventListener('click', testTauriAPI);
      
      // Auto-test on load
      setTimeout(() => {
        updateStatus('Initializing...', 'info');
        setTimeout(testTauriAPI, 500);
      }, 100);
    </script>
  </body>
</html>
